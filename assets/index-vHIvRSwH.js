(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function r(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=r(s);fetch(s.href,o)}})();document.addEventListener("DOMContentLoaded",()=>{const calculator=document.querySelector(".buttons-grid"),screen=document.querySelector(".textScreen"),historyScreen=document.querySelector(".history-screen"),themeToggleBtn=document.getElementById("theme-toggle-btn"),moonIconSVG='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>',sunIconSVG='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>';let state={firstValue:"",operator:"",displayValue:"0",needsReset:!1,history:[],isTestModeActive:!1,currentProblem:null,userAnswer:"",score:0};const generateProblem=()=>{const operators=["+","-","*","/"],operator=operators[Math.floor(Math.random()*operators.length)];let num1,num2;if(operator==="/"){const t=Math.floor(Math.random()*9)+2;num2=Math.floor(Math.random()*9)+2,num1=t*num2}else num1=Math.floor(Math.random()*10)+1,num2=Math.floor(Math.random()*10)+1,operator==="-"&&num1<num2&&([num1,num2]=[num2,num1]);const problem={num1,num2,operator,question:`${num1} ${operator==="*"?"×":operator} ${num2} = ?`,answer:eval(`${num1} ${operator} ${num2}`)};state.currentProblem=problem},startTestMode=()=>{state.isTestModeActive=!0,state.score=0,state.userAnswer="",generateProblem(),updateScreen(),updateTestButton(),console.log("Modo Test Iniciado!"),console.log(`Nuevo problema: ${state.currentProblem.question}`)},endTestMode=()=>{state.isTestModeActive=!1,clearAll(),updateTestButton(),screen.textContent="0",console.log("Modo Test finalizado.")},checkAnswer=()=>{if(!state.isTestModeActive)return;const t=screen.parentElement,e=state.currentProblem.answer;parseInt(state.userAnswer,10)===e?(state.score++,console.log(`¡Correcto! Tu puntuación es: ${state.score}`),t.classList.add("bg-green-500/50")):(console.log(`Incorrecto. La respuesta era ${e}. Tu puntuación se reinicia.`),state.score=0,t.classList.add("bg-red-500/50")),state.userAnswer="",updateScreen(),setTimeout(()=>{t.classList.remove("bg-green-500/50","bg-red-500/50"),generateProblem(),updateScreen()},500)},calculate=(t,e,r)=>{const n=parseFloat(t),s=parseFloat(r);return e==="+"?n+s:e==="-"?n-s:e==="*"?n*s:e==="/"&&s!==0?n/s:"Error"},handleNumber=t=>{state.needsReset&&(state.displayValue="",state.needsReset=!1),state.displayValue=state.displayValue==="0"?t:state.displayValue+t},handleOperator=t=>{if(state.operator&&!state.needsReset){const e=calculate(state.firstValue,state.operator,state.displayValue);state.displayValue=String(e),state.firstValue=String(e)}else state.firstValue=state.displayValue;state.operator=t,state.needsReset=!0},handleDecimal=()=>{state.needsReset&&(state.displayValue="0",state.needsReset=!1),state.displayValue.includes(".")||(state.displayValue+=".")},handleDelete=()=>{state.displayValue=state.displayValue.length>1?state.displayValue.slice(0,-1):"0"},handleSign=()=>{state.displayValue!=="0"&&(state.displayValue=String(parseFloat(state.displayValue)*-1))},handlePercent=()=>{state.displayValue=String(parseFloat(state.displayValue)/100)},performCalculation=()=>{if(state.firstValue&&state.operator){const t=state.displayValue,e=calculate(state.firstValue,state.operator,t);if(e!=="Error"){const r=`${state.firstValue} ${state.operator} ${t} = ${e}`;state.history.push(r)}state.displayValue=String(e),state.firstValue=String(e),state.operator="",state.needsReset=!0,updateHistoryDisplay()}},clearAll=()=>{state.firstValue="",state.operator="",state.displayValue="0",state.needsReset=!1,state.history=[],updateHistoryDisplay()},updateScreen=()=>{state.isTestModeActive?(state.currentProblem&&(historyScreen.textContent=`Score: ${state.score} | ${state.currentProblem.question}`),screen.textContent=state.userAnswer||"?"):(historyScreen.textContent=state.history[state.history.length-1]||"",screen.textContent=state.displayValue),screen.textContent.length>16?screen.style.fontSize="1.5rem":screen.textContent.length>10?screen.style.fontSize="2.25rem":screen.style.fontSize="3rem"},updateHistoryDisplay=()=>{historyScreen.textContent=state.history[state.history.length-1]||""},applyTheme=t=>{t==="dark"?(document.documentElement.classList.add("dark"),themeToggleBtn.innerHTML=sunIconSVG):(document.documentElement.classList.remove("dark"),themeToggleBtn.innerHTML=moonIconSVG)};calculator.addEventListener("click",t=>{const e=t.target.closest("button");if(!e)return;const{action:r,value:n}=e.dataset;if(r==="test"){state.isTestModeActive?endTestMode():startTestMode();return}state.isTestModeActive?(r==="number"&&(state.userAnswer+=n),r==="calculate"&&checkAnswer(),r==="delete"&&(state.userAnswer=state.userAnswer.slice(0,-1))):(r==="number"&&handleNumber(n),r==="operator"&&handleOperator(n),r==="decimal"&&handleDecimal(),r==="delete"&&handleDelete(),r==="sign"&&handleSign(),r==="percent"&&handlePercent(),r==="calculate"&&performCalculation(),r==="clear"&&clearAll()),updateScreen()}),window.addEventListener("keydown",t=>{const e=t.key;["/","*","-","+","Enter","%"].includes(e)&&t.preventDefault(),state.isTestModeActive?(!isNaN(e)&&e.trim()!==""&&(state.userAnswer+=e),(e==="Enter"||e==="=")&&checkAnswer(),e==="Backspace"&&(state.userAnswer=state.userAnswer.slice(0,-1))):(!isNaN(e)&&e.trim()!==""&&handleNumber(e),["+","-","*","/"].includes(e)&&handleOperator(e),e==="."&&handleDecimal(),e==="Backspace"&&handleDelete(),e==="%"&&handlePercent(),(e==="Enter"||e==="=")&&performCalculation(),(e==="Escape"||e==="Delete")&&clearAll()),updateScreen()}),themeToggleBtn.addEventListener("click",()=>{const t=document.documentElement.classList.contains("dark")?"light":"dark";localStorage.setItem("theme",t),applyTheme(t)});function updateTestButton(){const t=document.querySelector('button[data-action="test"]');if(!t)return;const e=t.querySelector("svg"),r='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 mb-1"><circle cx="12" cy="12" r="10"/><polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76"/></svg>',n='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 mb-1"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>';state.isTestModeActive?(t.querySelector("span").textContent="Salir",t.classList.add("bg-red-400","hover:bg-red-500"),t.classList.remove("bg-gray-300","hover:bg-gray-400"),e&&(e.outerHTML=n)):(t.querySelector("span").textContent="Test",t.classList.remove("bg-red-400","hover:bg-red-500"),t.classList.add("bg-gray-300","hover:bg-gray-400"),e&&(e.outerHTML=r))}const init=()=>{const t=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");applyTheme(t),updateScreen(),updateHistoryDisplay(),updateTestButton()};init()});
